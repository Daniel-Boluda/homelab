app-template:
  controller:
    # HA is not supported
    replicas: 1
    type: statefulset

  image:
    repository: quay.io/389ds/dirsrv
    tag: "latest@sha256:f87810d0be654ad5cab809c9be966cd425bd87f83a559c44dd854ebacf1171ad"
  env:
    DS_ERRORLOG_LEVEL: "266354688"
    DS_SUFFIX_NAME: dc=grigri,dc=cloud
  envFrom:
    - secretRef:
        name: ldap-secret
  service:
    main:
      type: LoadBalancer
      loadBalancerIP: 192.168.193.3
      externalTrafficPolicy: Local
      ports:
        http:
          enabled: false
        ldap:
          port: 389
          protocol: TCP
          targetPort: 3389
        ldaps:
          port: 636
          protocol: TCP
          targetPort: 3636

  initContainers:
    chown:
      image: busybox
      command: ["sh", "-c", "chown -R 389:389 /data"]
      volumeMounts:
        - name: data
          mountPath: /data

  ingress:
    main:
      enabled: false

  securityContext:
    runAsUser: 389
    fsGroup: 389

  podSecurityContext:
    fsGroup: 389

  volumeClaimTemplates:
    - name: data
      mountPath: /data
      accessMode: "ReadWriteOnce"
      size: 100Mi
      storageClass: longhorn-ssd
  persistence:
    certs:
      enabled: true
      type: secret
      name: ldap-certs
      mountPath: /data/tls
      readOnly: true
    ca:
      enabled: true
      type: secret
      name: ldap-ca
      mountPath: /data/tls/ca
      readOnly: true
  resources:
    requests:
      cpu: 10m
      memory: 128Mi
