app-template:
  controller:
    replicas: 1

  image:
    repository: pando85/mealie
    tag: api-v1.0.0beta-5
  env:
    ALLOW_SIGNUP: false
    PUID: 1000
    PGID: 1000
    TZ: Europe/Madrid
    MAX_WORKERS: 1
    WEB_CONCURRENCY: 1
    BASE_URL: https://recetas.k8s.grigri
    DB_ENGINE: postgres
    POSTGRES_SERVER: mealie-postgres
    POSTGRES_PORT: 5432
    POSTGRES_DB: mealie
    POSTGRES_USER:
      valueFrom:
        secretKeyRef:
          name: mealie.mealie-postgres.credentials.postgresql.acid.zalan.do
          key: username
    POSTGRES_PASSWORD:
      valueFrom:
        secretKeyRef:
          name: mealie.mealie-postgres.credentials.postgresql.acid.zalan.do
          key: password

  persistence:
    data:
      enabled: true
      mountPath: /app/data/
      accessMode: ReadWriteMany
      size: 500Mi
      storageClass: longhorn-ssd
      skipuninstall: true

  enableServiceLinks: false
  service:
    main:
      ports:
        http:
          port: 9000

  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 1
      memory: 512Mi

  probes:
    startup:
      enabled: true
      spec:
        initialDelaySeconds: 30
        failureThreshold: 30
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 1

  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/instance: mealie-api
          app.kubernetes.io/name: mealie-api
