automation:
  - alias: Control persianas
    description: Sube al 40% a las 13:00 y la abre a las 21:00, cierra dormitorio a las 23:00
    mode: single
    trigger:
      - platform: time
        at: "13:00:00"
        id: "persianas_13h"
      - platform: time
        at: "21:00:00"
        id: "persianas_21h"
      - platform: time
        at: "23:30:00"
        id: "persianas_23h"
    condition: []
    action:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ trigger.id == 'persianas_13h' }}"
            sequence:
              - service: cover.set_cover_position
                target:
                  entity_id: cover.persiana_despacho
                data:
                  position: 60

              - service: cover.set_cover_position
                target:
                  entity_id: cover.persiana_invitados
                data:
                  position: 40

              # Solo dormitorio si lucia_guardia_nocturna est√° OFF
              - choose:
                  - conditions:
                      - condition: state
                        entity_id: input_boolean.lucia_guardia_nocturna
                        state: "off"
                    sequence:
                      - service: cover.set_cover_position
                        target:
                          entity_id: cover.persiana_dormitorio
                        data:
                          position: 40

          - conditions:
              - condition: template
                value_template: "{{ trigger.id == 'persianas_21h' }}"
            sequence:
              - service: cover.set_cover_position
                target:
                  entity_id: cover.persiana_despacho
                data:
                  position: 100
              - service: cover.set_cover_position
                target:
                  entity_id: cover.persiana_dormitorio
                data:
                  position: 100
              - service: cover.set_cover_position
                target:
                  entity_id: cover.persiana_invitados
                data:
                  position: 100

          - conditions:
              - condition: template
                value_template: "{{ trigger.id == 'persianas_23h' }}"
            sequence:
              - service: cover.set_cover_position
                target:
                  entity_id: cover.persiana_dormitorio
                data:
                  position: 0
