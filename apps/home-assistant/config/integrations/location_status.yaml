input_boolean:
  guardia_noche_lucia:
    name: Lucia ha tenido una guardia de noche en el hospital
  guardia_noche_lucia:
    name: Lucia ha tenido una guardia de noche en el hospital
  guardia_noche_lucia:
    name: Lucia ha tenido una guardia de noche en el hospital

automation:
  - alias: Actualizar estados basados en ubicaciones clave
    trigger:
      - platform: time
        at: "02:00:00"
        id: "daily_reset"
      - platform: time
        at: "02:00:00"
        id: "calculate_guardia_noche_lucia"
      - platform: zone
        entity_id: person.daniel_boluda_fdez_gmail_com
        zone: zone.supera_rivas
        event: enter
        id: "daniel_enter_supera_rivas"
      - platform: zone
        entity_id: person.pizarroservanlucia_gmail_com
        zone: zone.supera_rivas
        event: enter
        id: "lucia_enter_supera_rivas"

    condition: []
    action:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {{ trigger.id == 'daniel_enter_supera_rivas' }}
              - condition: not
                conditions:
                  - condition: state
                    entity_id: person.pizarroservanlucia_gmail_com
                    state: "zone.supera_rivas"
            sequence:
              - service: notify.mobile_app_iphone_de_lucia
                data:
                  message: "Daniel ha llegado a Supera Rivas."
                  title: "Ubicación"

          - conditions:
              - condition: template
                value_template: >
                  {{ trigger.platform == 'zone' and
                     trigger.entity_id == 'person.pizarroservanlucia_gmail_com' and
                     trigger.zone == 'zone.supera_rivas' and
                     trigger.event == 'enter' }}
              - condition: not
                conditions:
                  - condition: state
                    entity_id: person.daniel_boluda_fdez_gmail_com
                    state: "zone.supera_rivas"
            sequence:
              - service: notify.mobile_app_sm_a256b
                data:
                  message: "Lucía ha llegado a Supera Rivas."
                  title: "Ubicación"

          - conditions:
              - condition: template
                value_template: >
                  {{ trigger.platform == 'time' and
                     trigger.event == 'enter' }}
              - condition: not
                conditions:
                  - condition: state
                    entity_id: person.pizarroservanlucia_gmail_com
                    state: "zone.badminton"
            sequence:
              - condition: state
                entity_id: person.pizarroservanlucia_gmail_com
                state: "zone.hospital_gomez_ulla"
              - service: input_boolean.turn_on
                target:
                  entity_id: input_boolean.guardia_noche

    mode: single
