automation:
  - alias: Recordatorio tapa inodoro
    description: "Si la tapa del inodoro estÃ¡ vertical y la luz apagada, enviar recordatorio."
    mode: single
    trigger:
      - platform: state
        entity_id:
          - sensor.tapa_inhodoro_aseo_z
          - sensor.tapa_inhodoro_bano_z
          - switch.luz_banera
          - switch.luz_aseo
          - switch.luz_bano_dormitorio
          - switch.luz_ducha_dormitorio
    condition: []
    action:
      - choose:
          # Aseo
          - conditions:
              - condition: state
                entity_id: switch.luz_banera
                state: "off"
              - condition: state
                entity_id: switch.luz_aseo
                state: "off"
            sequence:
              - delay: "00:00:05"  # Espera para que Zigbee actualice estados
              - condition: and
                conditions:
                  - condition: numeric_state
                    entity_id: sensor.tapa_inhodoro_aseo_z
                    below: 100
                  - condition: state
                    entity_id: switch.luz_banera
                    state: "off"
                  - condition: state
                    entity_id: switch.luz_aseo
                    state: "off"
                  - condition: state
                    entity_id: input_boolean.home_announcements_active
                    state: "on"
              - service: notify.alexa_media
                data:
                  target:
                    - media_player.echo_salon        # ðŸ‘ˆ cambia por tus Echos
                  message: "Recuerda bajar la tapa del inodoro del aseo."
                  data:
                    type: announce
                    method: speak

          # BaÃ±o
          - conditions:
              - condition: state
                entity_id: switch.luz_bano_dormitorio
                state: "off"
              - condition: state
                entity_id: switch.luz_ducha_dormitorio
                state: "off"
            sequence:
              - delay: "00:00:05"  # Espera para que Zigbee actualice estados
              - condition: and
                conditions:
                  - condition: numeric_state
                    entity_id: sensor.tapa_inhodoro_bano_z
                    below: 100
                  - condition: state
                    entity_id: switch.luz_bano_dormitorio
                    state: "off"
                  - condition: state
                    entity_id: switch.luz_ducha_dormitorio
                    state: "off"
                  - condition: state
                    entity_id: input_boolean.home_announcements_active
                    state: "on"
              - service: notify.alexa_media
                data:
                  target:
                    - media_player.echo_salon        # ðŸ‘ˆ cambia por tus Echos
                  message: "Recuerda bajar la tapa del inodoro del baÃ±o."
                  data:
                    type: announce
                    method: speak
