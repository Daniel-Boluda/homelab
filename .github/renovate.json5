{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: ["config:base", ":preserveSemverRanges"],
  platform: "github",
  username: "renovate85-bot[bot]",
  repositories: ["pando85/homelab"],
  gitAuthor: "Renovate <4646670+renovate85-bot[bot]@users.noreply.github.com>",
  forkProcessing: "enabled",
  rebaseWhen: "conflicted",
  branchConcurrentLimit: 20,
  prConcurrentLimit: 20,
  prHourlyLimit: 20,
  commitMessagePrefix: "{{parentDir}}: ",
  timezone: "Europe/Madrid",
  schedule: ["after 5am and before 9am on Monday"],
  enabledManagers: [
    "argocd",
    "github-actions",
    "helm-values",
    "helmv3",
    "kustomize",
    "pre-commit",
    "regex",
  ],
  regexManagers: [
    {
      description: "Process custom dependencies with double quotes, after colon, URLs and variables",
      fileMatch: [".+\\.ya?ml$"],
      matchStrings: [
        '#\\srenovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)( versioning=(?<versioning>\\S+))?\n.*?"(?<currentValue>.*)"\n',
        '#\\srenovate: datasource=(?<datasource>\\S+)( versioning=(?<versioning>\\S+))?\n.*?: (?<depName>\\S+):(?<currentValue>.*)\n',
        '#\\srenovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)( versioning=(?<versioning>\\S+))?\n.*?\\/v?(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)\\/.*',
        '#\\srenovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)( versioning=(?<versioning>\\S+))?\n.*?: (?<currentValue>.*)\n',
      ],
      versioningTemplate: "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}",
    },
  ],
  packageRules: [
    {
      matchPackagePatterns: ".*",
      additionalBranchPrefix: "{{parentDir}}-",
      addLabels: ["renovate/{{parentDir}}"],
    },
    {
      description: "Loose versioning for non-semver packages",
      matchDatasources: ["docker"],
      versioning: "loose",
      matchPackagePatterns: ["plex", "qbittorrent"],
    },
    {
      matchDatasources: ["docker"],
      matchUpdateTypes: ["minor", "patch"],
      matchCurrentVersion: "!/^0/",
      automerge: true,
      automergeType: "pr",
      ignoreTests: true,
      platformAutomerge: true,
    },
    {
      matchDatasources: ["helm"],
      matchUpdateTypes: ["patch"],
      matchCurrentVersion: "!/^0/",
      automerge: true,
      automergeType: "pr",
      ignoreTests: true,
      platformAutomerge: true,
    },
    {
      matchPackageNames: ["app-template"],
      matchUpdateTypes: ["minor", "patch"],
      matchCurrentVersion: "!/^0/",
      automerge: true,
      automergeType: "pr",
      ignoreTests: true,
      platformAutomerge: true,
    },
    {
      matchPackageNames: ["vault"],
      matchManagers: ["regex"],
      matchUpdateTypes: ["major", "minor"],
      minimumReleaseAge: "30 days",
    },
    {
      matchPackageNames: [
        "rook-ceph",
        "rook-ceph-cluster",
      ],
      matchDatasources: ["helm"],
      matchUpdateTypes: ["major", "minor"],
      minimumReleaseAge: "30 days",
    },
    {
      matchPackageNames: [
        "rook-ceph-cluster",
      ],
      matchDatasources: ["helm"],
      matchUpdateTypes: ["patch"],
      matchCurrentVersion: "!/^0/",
      automerge: false,
    },
    {
      matchPackageNames: ["k3s-io/k3s"],
      matchManagers: ["regex"],
      matchUpdateTypes: ["major", "minor"],
      minimumReleaseAge: "120 days",
      groupName: "k3s upgrade",
    },
    {
      // group k3s changes in one PR
      matchPackageNames: ["k3s-io/k3s"],
      matchManagers: ["regex"],
      additionalBranchPrefix: "k3s-",
      addLabels: ["renovate/k3s"],
      groupName: "k3s upgrade",
      groupSlug: "k3s-upgrade",
    },
  ],
  ignoreDeps: [
    // deprecated docker image
    "ghcr.io/onedr0p/jackett",
  ]
}
